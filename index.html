<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Surf Spots Dakar ‚Äî Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: url('https://images.unsplash.com/photo-1517409477526-a664dd38b1f4?q=80&w=2670&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center fixed;
            background-size: cover;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto;
            color: #075985;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .arrow {
            display:inline-block;
            width:36px;
            height:36px;
            transform-origin: center center;
            transition: transform 0.4s ease;
        }

        .spot-card {
            min-height:220px;
        }

        /* Style pour le logo */
        .logo-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 100;
        }

        .logo {
            width: 50px;
            height: auto;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Style pour la phrase d'approche */
        .surf-tagline {
            background-color: rgba(7, 89, 133, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 1rem;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 1rem;
            max-width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Style pour les titres des sections - Position rapproch√©e */
        .section-title {
            background-color: rgba(7, 89, 133, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 1rem;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
            max-width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Styles pour le conteneur M√©t√©o */
        .all-weather-container {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 100%;
            background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center;
            background-size: cover;
            margin-top: 2rem;
        }

        /* Styles pour le conteneur Mar√©es */
        .all-tides-container {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            margin: 0.5rem 0;
            background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center;
            background-size: cover;
            max-width: 3xl;
        }

        /* Styles pour le conteneur Spots de Surf */
        .all-spots-container {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
            margin-top: 0.5rem;
            background: url('https://images.unsplash.com/photo-1519046904884-53103b34b206?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center;
            background-size: cover;
        }

        /* Overlay pour les trois conteneurs */
        .all-weather-container::before, .all-tides-container::before, .all-spots-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 0;
        }

        /* Assurez-vous que le contenu est au-dessus de l'overlay */
        .all-weather-container > *, .all-tides-container > *, .all-spots-container > * {
            position: relative;
            z-index: 1;
        }

        /* Style des cartes m√©t√©o */
        .weather-card {
            background-color: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
        }

        /* Style pour les cartes de mar√©es - R√©duit */
        .tide-card {
            background-color: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            text-align: center;
            width: 100%;
        }

        /* Style pour les informations de mar√©e - Compact */
        .tide-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            margin: 0.5rem 0;
        }

        .tide-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            min-width: 100px;
        }

        .tide-type {
            font-weight: bold;
            font-size: 0.75rem;
            color: #075985;
            margin-bottom: 0.125rem;
        }

        .tide-time {
            font-size: 1.125rem;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 0.125rem;
        }

        .tide-height {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e293b;
        }

        .tide-direction {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.125rem;
        }

        /* Style pour le conteneur spots */
        .spot-card {
            background-color: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            text-align: center;
            min-height: 220px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .spot-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .wave-rating {
            font-weight: bold;
            font-size: 0.875rem;
        }

        .rating-excellent { color: #10b981; }
        .rating-good { color: #f59e0b; }
        .rating-fair { color: #f97316; }
        .rating-poor { color: #ef4444; }

        .difficulty-beginner { color: #22c55e; font-weight: bold; }
        .difficulty-intermediate { color: #f97316; font-weight: bold; }
        .difficulty-expert { color: #ef4444; font-weight: bold; }

        /* Style pour le loading et erreurs */
        .loading {
            text-align: center;
            color: white;
            font-size: 1rem;
            padding: 2rem;
        }

        .error {
            text-align: center;
            color: #f87171;
            font-size: 0.875rem;
            padding: 1rem;
            background: rgba(248, 113, 113, 0.1);
            border-radius: 0.5rem;
            border: 1px solid rgba(248, 113, 113, 0.3);
        }

        .success {
            text-align: center;
            color: #10b981;
            font-size: 0.875rem;
            padding: 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 0.5rem;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6 relative">
    <div class="logo-container">
        <img src="https://i.ibb.co/0mQ5j5j/malika-surf-camp.png" alt="Malika Surf Camp" class="logo">
    </div>

    <div class="surf-tagline">
        "Votre check quotidien : m√©t√©o pr√©cise et vagues live pour choper les meilleurs spots de Dakar !"
    </div>

    <h1 class="text-2xl font-bold mb-4 text-white text-shadow-lg">Surf Spots - Dakar (live)</h1>

    <div class="section-title">üå§Ô∏è M√©t√©o</div>

    <div class="all-weather-container mb-2 shadow-xl">
        <div id="weather-content">
            <div class="loading">üîÑ Chargement des donn√©es m√©t√©o en temps r√©el...</div>
        </div>
    </div>

    <div class="section-title">üåä Mar√©es √† Dakar</div>

    <div class="all-tides-container shadow-xl">
        <div id="tides-content">
            <div class="loading">üîÑ Calcul des mar√©es...</div>
        </div>
    </div>

    <div class="section-title">üåä Spots de Surf</div>

    <div class="all-spots-container shadow-xl">
        <div id="spots-content">
            <div class="loading">üîÑ Calcul des conditions de vagues...</div>
        </div>
    </div>

    <button id="refreshBtn" class="mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700" onclick="loadData()">
        üîÑ Actualiser tout
    </button>

    <script>
        // Fonction pour mapper les codes m√©t√©o Open-Meteo vers emojis
        function getWeatherEmoji(code) {
            const weatherMap = {
                0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è',
                45: 'üå´Ô∏è', 48: 'üå´Ô∏è', 51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üåßÔ∏è',
                61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: '‚õàÔ∏è', 71: '‚ùÑÔ∏è', 73: '‚ùÑÔ∏è', 75: '‚ùÑÔ∏è',
                80: 'üå¶Ô∏è', 81: 'üå¶Ô∏è', 82: '‚õàÔ∏è', 95: '‚õàÔ∏è', 96: '‚õàÔ∏è', 99: '‚õàÔ∏è'
            };
            return weatherMap[code] || 'üå§Ô∏è';
        }

        // Coordonn√©es des spots de Dakar + orientations et difficult√©s
        const spotsData = [
            { name: 'Yoff', lat: 14.7600, lon: -17.4800, direction: 90, difficulty: 'expert', description: 'Vagues puissantes et rapides, avec un courant fort. R√©serv√© aux surfeurs exp√©riment√©s et professionnels.' },
            { name: 'Les Almadies', lat: 14.7167, lon: -17.5000, direction: 180, difficulty: 'intermediate', description: 'Des vagues de qualit√©, plus rapides et plus puissantes. Id√©al pour les surfeurs de niveau interm√©diaire cherchant √† progresser.' },
            { name: 'Le Virage', lat: 14.7000, lon: -17.4900, direction: 135, difficulty: 'beginner', description: 'Plage de sable avec des vagues douces et consistantes. Le spot parfait pour les d√©butants et pour l\'apprentissage.' },
            { name: 'Ngor', lat: 14.7200, lon: -17.5200, direction: 45, difficulty: 'beginner', description: 'Cadre magnifique et vagues consistantes. Un excellent choix pour les d√©butants et pour se perfectionner.' },
            { name: 'Ouakam', lat: 14.7400, lon: -17.4700, direction: 90, difficulty: 'intermediate', description: 'Vagues creuses et rapides, demandant technique et exp√©rience. Plus adapt√© aux surfeurs de niveau interm√©diaire √† confirm√©.' },
            { name: 'Secret Spot', lat: 14.7100, lon: -17.5100, direction: 120, difficulty: 'expert', description: 'Un reef break qui offre des vagues tubulaires. Un spot technique et risqu√©, pour les surfeurs tr√®s exp√©riment√©s.' }
        ];

        // Fonction pour calculer mar√©es (bas√© sur heure lunaire + vent)
        function calculateTides(currentTime, windSpeed) {
            // P√©riode lunaire ~12h25, phase bas√©e sur UTC
            const lunarHour = (currentTime.getUTCHours() * 60 + currentTime.getUTCMinutes()) % (12.42 * 60);
            const phase = Math.sin((lunarHour / (12.42 * 60)) * Math.PI * 2);

            // Amplitude de base pour Dakar (~1.5m) modul√©e par vent
            const baseAmplitude = 1.5;
            const windFactor = 1 + (windSpeed / 50); // Vent augmente amplitude
            const currentLevel = (phase * baseAmplitude * windFactor + baseAmplitude) / 2;

            // Trouver prochaine haute/basse
            const nowMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();
            const highTimeMinutes = ((Math.round((lunarHour + 6.21 * 60) / (12.42 * 60)) * 12.42 * 60) % (24 * 60));
            const lowTimeMinutes = ((Math.round((lunarHour - 6.21 * 60 + 24 * 60) / (12.42 * 60)) * 12.42 * 60) % (24 * 60));

            const highTime = new Date(currentTime);
            highTime.setHours(Math.floor(highTimeMinutes / 60), highTimeMinutes % 60, 0, 0);
            const lowTime = new Date(currentTime);
            lowTime.setHours(Math.floor(lowTimeMinutes / 60), lowTimeMinutes % 60, 0, 0);

            // Temps restant
            const timeToHigh = Math.max(0, (highTime - currentTime) / (1000 * 60 * 60));
            const timeToLow = Math.max(0, (lowTime - currentTime) / (1000 * 60 * 60));

            const highHeight = (baseAmplitude * windFactor).toFixed(1);
            const lowHeight = (0.3).toFixed(1); // Basse mar√©e minimale

            return {
                high: { time: highTime.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}), height: highHeight },
                low: { time: lowTime.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}), height: lowHeight },
                next: timeToHigh < timeToLow ? `Haute dans ${Math.round(timeToHigh)}h` : `Basse dans ${Math.round(timeToLow)}h`,
                currentLevel: currentLevel.toFixed(1)
            };
        }

        // Fonction pour calculer conditions vagues par spot
        function calculateSpotConditions(baseWindSpeed, baseWindDir, spot) {
            // Fetch distance sp√©cifique au spot (km)
            const fetchDistances = { yoff: 1200, almadies: 1500, virage: 1100, ngor: 800, ouakam: 1000, secret: 900 };

            // Calcul hauteur de vague (formule simplifi√©e)
            const windMps = baseWindSpeed / 3.6;
            const fetch = fetchDistances[spot.name.toLowerCase()] || 1000;
            const baseHeight = 0.016 * Math.pow(windMps, 2) * fetch / 9.81;
            const spotHeight = Math.max(0.3, Math.min(3.0, baseHeight * (1 + Math.random() * 0.3))); // Variation locale

            // P√©riode bas√©e sur hauteur
            const period = Math.max(5, Math.min(15, 1.56 * Math.pow(spotHeight, 0.4)));

            // Angle vent-spot (0¬∞ = onshore, 90¬∞ = cross, 180¬∞ = offshore)
            let windAngle = Math.abs(baseWindDir - spot.direction);
            if (windAngle > 180) windAngle = 360 - windAngle;
            const crossShore = Math.min(windAngle, 180 - windAngle);

            // Score qualit√© (0-100)
            let score = 0;
            if (spotHeight >= 0.8 && spotHeight <= 2.5) score += 30;
            else if (spotHeight >= 0.5) score += 15;
            if (period >= 7) score += 20;
            if (crossShore >= 90 && crossShore <= 135) score += 40; // Offshore
            else if (crossShore >= 60) score += 20; // Cross-shore
            if (baseWindSpeed <= 20) score += 10;

            const ratingClass = score >= 70 ? 'rating-excellent' : score >= 50 ? 'rating-good' :
                                score >= 30 ? 'rating-fair' : 'rating-poor';
            const ratingText = score >= 70 ? 'Excellent' : score >= 50 ? 'Bon' : score >= 30 ? 'Moyen' : 'Mauvais';

            return {
                height: spotHeight.toFixed(1),
                period: period.toFixed(1),
                windSpeed: Math.round(baseWindSpeed),
                windRelative: crossShore <= 45 ? 'Onshore' : crossShore <= 90 ? 'Cross' : 'Offshore',
                score: Math.round(score),
                ratingClass,
                ratingText
            };
        }

        // Fonction pour charger la m√©t√©o (base pour tout)
        async function loadWeather() {
            try {
                const apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=14.6937&longitude=-17.4441&current=temperature_2m,relative_humidity_2m,wind_speed_10m,wind_direction_10m,weather_code&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=Africa%2FDakar&forecast_days=3';

                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                console.log('‚úÖ Donn√©es m√©t√©o:', data);

                const current = data.current;
                const hourly = data.hourly;
                const daily = data.daily;
                const now = new Date();
                const currentHour = now.getHours();

                // Mettre √† jour m√©t√©o
                const weatherContent = document.getElementById('weather-content');
                const todayEmoji = getWeatherEmoji(current.weather_code);
                const windDir = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'][
                    Math.round(current.wind_direction_10m / 22.5) % 16
                ];

                weatherContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 w-full">
                        <div class="weather-card flex flex-col items-center justify-center">
                            <h3 class="text-lg font-bold mb-2">Maintenant</h3>
                            <div class="flex items-center space-x-3">
                                <span class="text-3xl">${todayEmoji}</span>
                                <div>
                                    <p class="text-2xl font-bold">${Math.round(current.temperature_2m)}¬∞C</p>
                                    <p class="text-sm">Ressenti : ${Math.round(current.temperature_2m)}¬∞C</p>
                                </div>
                            </div>
                            <div class="mt-3 text-xs text-center">
                                <p>Humidit√© : ${current.relative_humidity_2m}%</p>
                                <p>Vent : ${Math.round(current.wind_speed_10m * 3.6)} km/h (${windDir})</p>
                            </div>
                        </div>

                        <div class="weather-card flex flex-col items-center justify-center">
                            <h3 class="text-lg font-bold mb-2">Aujourd'hui</h3>
                            <div class="flex items-center space-x-3">
                                <span class="text-3xl">${todayEmoji}</span>
                                <div>
                                    <p class="text-2xl font-bold">${Math.round(daily.temperature_2m_max[0])}¬∞C</p>
                                    <p class="text-sm">Max de la journ√©e</p>
                                </div>
                            </div>
                            <div class="mt-3 text-xs text-center">
                                <p>Min : ${Math.round(daily.temperature_2m_min[0])}¬∞C</p>
                                <p>Moyenne : ${Math.round((daily.temperature_2m_max[0] + daily.temperature_2m_min[0]) / 2)}¬∞C</p>
                            </div>
                        </div>

                        <div class="weather-card md:col-span-2 lg:col-span-1">
                            <h3 class="text-sm font-bold mb-2">Prochaines 6h</h3>
                            <div class="flex overflow-x-auto space-x-3 pb-2">
                                ${Array.from({length: 6}, (_, i) => {
                                    const hourIndex = (currentHour + i + 1) % 24;
                                    const time = new Date(now);
                                    time.setHours(time.getHours() + i + 1);
                                    const hourStr = time.getHours().toString().padStart(2, '0') + ':00';
                                    const temp = Math.round(hourly.temperature_2m[hourIndex]);
                                    const code = hourly.weather_code[hourIndex];
                                    return `<div class="text-center flex-shrink-0 min-w-[60px]">
                                        <p class="text-xs">${hourStr}</p>
                                        <span class="text-lg block">${getWeatherEmoji(code)}</span>
                                        <p class="text-xs">${temp}¬∞C</p>
                                    </div>`;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="success mt-2">‚úÖ M√©t√©o mise √† jour - ${new Date().toLocaleString('fr-FR')}</div>
                `;

                // Stocker pour mar√©es et spots
                window.weatherData = { current, hourly, daily, now };
                return data;

            } catch (error) {
                console.error('‚ùå Erreur m√©t√©o:', error);
                document.getElementById('weather-content').innerHTML = `
                    <div class="error">
                        <p>‚ùå Erreur de connexion m√©t√©o</p>
                        <p class="text-sm mt-2">Utilisation donn√©es de fallback</p>
                    </div>
                `;
                // Fallback data
                window.weatherData = {
                    current: { temperature_2m: 28, wind_speed_10m: 15, wind_direction_10m: 45, relative_humidity_2m: 70 },
                    now: new Date()
                };
            }
        }

        // Fonction pour mar√©es (calcul√©es localement)
        function loadTides() {
            try {
                const { now } = window.weatherData || { now: new Date() };
                const windSpeed = window.weatherData?.current?.wind_speed_10m * 3.6 || 15;
                const tides = calculateTides(now, windSpeed);

                const tidesContent = document.getElementById('tides-content');
                tidesContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center">
                        <div class="text-3xl mb-2">üåä</div>

                        <div class="tide-info">
                            <div class="tide-item">
                                <div class="tide-type">Haute</div>
                                <div class="tide-time">${tides.high.time}</div>
                                <div class="tide-height">${tides.high.height} m</div>
                                <div class="tide-direction">‚Üë</div>
                            </div>

                            <div class="tide-item">
                                <div class="tide-type">Basse</div>
                                <div class="tide-time">${tides.low.time}</div>
                                <div class="tide-height">${tides.low.height} m</div>
                                <div class="tide-direction">‚Üì</div>
                            </div>
                        </div>

                        <div class="mt-4 text-xs text-gray-700">
                            <p><strong>Prochaine :</strong> ${tides.next}</p>
                            <p class="text-gray-600">Niveau actuel : ${tides.currentLevel} m</p>
                        </div>
                    </div>
                    <div class="success mt-2">‚úÖ Mar√©es calcul√©es localement</div>
                `;

            } catch (error) {
                console.error('‚ùå Erreur mar√©es:', error);
                document.getElementById('tides-content').innerHTML = `
                    <div class="loading">
                        <p>‚ùå Erreur calcul mar√©es</p>
                        <p class="text-sm mt-2">Donn√©es de base utilis√©es</p>
                    </div>
                `;
            }
        }

        // Fonction pour spots (calcul√©s localement)
        function loadSpots() {
            try {
                const { current, now } = window.weatherData || {
                    current: { wind_speed_10m: 15, wind_direction_10m: 45 },
                    now: new Date()
                };
                const windSpeed = current.wind_speed_10m * 3.6;
                const windDir = current.wind_direction_10m;

                const spotsContent = document.getElementById('spots-content');
                let spotsHtml = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 w-full">';

                spotsData.forEach(spot => {
                    const conditions = calculateSpotConditions(windSpeed, windDir, spot);

                    const difficultyClass = spot.difficulty === 'beginner' ? 'difficulty-beginner'
                                          : spot.difficulty === 'intermediate' ? 'difficulty-intermediate'
                                          : 'difficulty-expert';
                    const difficultyText = spot.difficulty === 'beginner' ? 'D√©butant'
                                         : spot.difficulty === 'intermediate' ? 'Interm√©diaire'
                                         : 'Pro & Expert';
                    const difficultyEmoji = spot.difficulty === 'beginner' ? 'üèÑ‚Äç‚ôÇÔ∏è'
                                          : spot.difficulty === 'intermediate' ? 'ü§ô'
                                          : 'üî•';

                    spotsHtml += `
                        <div class="spot-card">
                            <h2 class="text-lg font-bold mb-1">${spot.name}</h2>
                            <p class="text-sm ${difficultyClass} mb-2">${difficultyEmoji} ${difficultyText}</p>
                            <div class="text-xs text-gray-800 mb-3">${spot.description}</div>
                            <div class="flex flex-col items-center mt-2">
                                <span class="text-4xl">üåä</span>
                                <div class="text-sm mt-1">Hauteur : ${conditions.height} m</div>
                                <div class="text-sm">P√©riode : ${conditions.period} s</div>
                            </div>
                            <div class="mt-3 text-sm text-gray-700">
                                Vent : ${conditions.windSpeed} km/h (${conditions.windRelative})
                            </div>
                            <div class="mt-2 flex justify-center" style="transform: rotate(${windDir}deg);">
                                <svg class="arrow" viewBox="0 0 24 24">
                                    <path d="M12 2 L15 8 H13 V22 H11 V8 H9 L12 2 Z" fill="#075985"></path>
                                </svg>
                            </div>
                            <div class="mt-3 text-xs">
                                <span class="wave-rating ${conditions.ratingClass}">${conditions.ratingText}</span>
                                <div class="text-gray-500">Score : ${conditions.score}/100</div>
                            </div>
                        </div>
                    `;
                });

                spotsHtml += '</div>';
                spotsContent.innerHTML = spotsHtml;

                const successDiv = document.createElement('div');
                successDiv.className = 'success mt-2 w-full text-center';
                successDiv.textContent = '‚úÖ Conditions de vagues calcul√©es';
                spotsContent.appendChild(successDiv);

            } catch (error) {
                console.error('‚ùå Erreur spots:', error);
                document.getElementById('spots-content').innerHTML = `
                    <div class="loading">
                        <p>‚ùå Erreur calcul spots</p>
                        <p class="text-sm mt-2">Conditions de base utilis√©es</p>
                    </div>
                `;
            }
        }

        // Fonction pour charger toutes les donn√©es
        async function loadData() {
            const btn = document.getElementById('refreshBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Mise √† jour...';
            btn.disabled = true;

            try {
                console.log('üöÄ D√©but mise √† jour compl√®te...');
                await loadWeather(); // Charge m√©t√©o ET stocke les donn√©es
                loadTides(); // Utilise donn√©es m√©t√©o pour calculs
                loadSpots(); // Utilise donn√©es m√©t√©o pour calculs
                console.log('‚úÖ Mise √† jour compl√®te termin√©e !');
            } catch (error) {
                console.error('‚ùå Erreur globale:', error);
            } finally {
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
        }

        // Charger au d√©marrage
        window.addEventListener('load', () => {
            console.log('üöÄ Initialisation Surf Dakar Live...');
            loadData();
        });

        // Auto-refresh toutes les 30 minutes
        setInterval(loadData, 30 * 60 * 1000);
    </script>
</body>
</html>
