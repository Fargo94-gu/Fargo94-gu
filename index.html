<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Surf Spots Dakar & Maroc</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #0077b6, #90e0ef);
      margin: 0; padding: 0;
      color: white;
    }
    header {
      text-align: center;
      padding: 1rem;
      background: #023e8a;
      box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    }
    h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    #regionSelector {
      margin: 1rem auto;
      display: block;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }
    .spots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .spot {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.4);
      transition: transform 0.3s, background 0.3s;
    }
    .spot:hover {
      transform: scale(1.05);
      background: rgba(0,0,0,0.5);
    }
    .spot h3 {
      margin-top: 0;
    }
    .spot .desc {
      font-size: 0.85rem;
      opacity: 0.9;
    }
    .data {
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>🌊 Surf Spots Dakar & Maroc</h1>
    <select id="regionSelector">
      <option value="dakar">Dakar</option>
      <option value="maroc">Maroc</option>
    </select>
  </header>
  <main>
    <div id="spots" class="spots"></div>
  </main>

  <script>
    // --- LISTE DES SPOTS ---

    const spotsDakar = [
      { name: 'Yoff Beach', lat: 14.764, lon: -17.489, icon: '🏖️', description: 'Grande plage adaptée aux débutants et intermédiaires.', difficulty: 'beginner' },
      { name: 'Ngor Right', lat: 14.751, lon: -17.506, icon: '🤙', description: 'Droite parfaite, spot mondialement connu.', difficulty: 'intermediate' },
      { name: 'Ngor Left', lat: 14.752, lon: -17.508, icon: '🌊', description: 'Gauche puissante et régulière.', difficulty: 'expert' },
      { name: 'Ouakam', lat: 14.689, lon: -17.473, icon: '🔥', description: 'Reef break creux réservé aux experts.', difficulty: 'expert' },
      { name: 'Almadies', lat: 14.740, lon: -17.510, icon: '🌴', description: 'Plusieurs pics puissants, bons pour tous niveaux selon la houle.', difficulty: 'intermediate' }
    ];

    const spotsMaroc = [
      { name: 'Anchor Point', lat: 30.138, lon: -9.697, icon: '🌊', description: 'Droite longue et puissante, spot mythique de Taghazout.', difficulty: 'expert' },
      { name: 'Hash Point', lat: 30.140, lon: -9.695, icon: '🔥', description: 'Droite technique avec sections rapides.', difficulty: 'intermediate' },
      { name: 'Banana Beach', lat: 30.100, lon: -9.680, icon: '🏄‍♂️', description: 'Parfait pour débutants avec une plage douce.', difficulty: 'beginner' },
      { name: 'Devil\'s Rock', lat: 30.095, lon: -9.675, icon: '🤙', description: 'Beach break polyvalent et fun.', difficulty: 'intermediate' },
      { name: 'Imsouane', lat: 30.170, lon: -9.540, icon: '🏄', description: 'La plus longue droite d’Afrique, idéale pour cruiser.', difficulty: 'beginner' },
      { name: 'Sidi Kaouki', lat: 31.890, lon: -9.760, icon: '🌴', description: 'Plage exposée avec grosses houles.', difficulty: 'intermediate' },
      { name: 'Essaouira Beach', lat: 31.510, lon: -9.770, icon: '🏖️', description: 'Plage adaptée aux débutants et freestyle.', difficulty: 'beginner' },
      { name: 'Tamraght', lat: 30.090, lon: -9.670, icon: '🌊', description: 'Spots variés pour tous niveaux.', difficulty: 'all' },
      { name: 'Killer Point', lat: 30.143, lon: -9.710, icon: '💀', description: 'Droite longue et puissante.', difficulty: 'expert' },
      { name: 'Boilers', lat: 30.600, lon: -9.850, icon: '🔥', description: 'Droite massive avec puissance.', difficulty: 'expert' }
    ];

    // --- RENDU DES SPOTS ---
    const regionSelector = document.getElementById("regionSelector");
    const spotsContainer = document.getElementById("spots");

    function renderSpots(region) {
      spotsContainer.innerHTML = "";
      const spots = region === "dakar" ? spotsDakar : spotsMaroc;
      spots.forEach(spot => {
        const div = document.createElement("div");
        div.className = "spot";
        div.innerHTML = `
          <h3>${spot.icon} ${spot.name}</h3>
          <div class="desc">${spot.description}<br><b>Niveau :</b> ${spot.difficulty}</div>
          <div class="data" id="data-${spot.name.replace(/\s+/g, '')}">Chargement...</div>
        `;
        spotsContainer.appendChild(div);
        loadData(spot);
      });
    }

    // --- APPELS API ---
    async function loadData(spot) {
      const el = document.getElementById("data-" + spot.name.replace(/\s+/g, ''));

      try {
        // Open-Meteo météo & vagues
        const meteoUrl = `https://api.open-meteo.com/v1/forecast?latitude=${spot.lat}&longitude=${spot.lon}&hourly=temperature_2m,windspeed_10m,wave_height&timezone=auto`;
        const resMeteo = await fetch(meteoUrl);
        const dataMeteo = await resMeteo.json();

        const temp = dataMeteo.hourly.temperature_2m[0];
        const wind = dataMeteo.hourly.windspeed_10m[0];
        const wave = dataMeteo.hourly.wave_height ? dataMeteo.hourly.wave_height[0] : "N/A";

        // Stormglass marées
        const apiKey = "0ec6f6b6-9546-11f0-b41a-0242ac130006-0ec6f742-9546-11f0-b41a-0242ac130006";
        let tide = "N/A";
        try {
          const sgUrl = `https://api.stormglass.io/v2/tide/sea-level/point?lat=${spot.lat}&lng=${spot.lon}&start=${new Date().toISOString()}&end=${new Date(Date.now()+6*3600*1000).toISOString()}`;
          const resSG = await fetch(sgUrl, { headers: { 'Authorization': apiKey }});
          if (resSG.ok) {
            const dataSG = await resSG.json();
            tide = dataSG.data && dataSG.data.length > 0 ? dataSG.data[0].sg : "N/A";
          }
        } catch (err) {
          console.error("Stormglass error:", err);
        }

        el.innerHTML = `
          🌡 Température : ${temp}°C<br>
          💨 Vent : ${wind} km/h<br>
          🌊 Vagues : ${wave} m<br>
          🌒 Marées : ${tide}
        `;
      } catch (e) {
        el.innerHTML = "Erreur chargement données";
        console.error(e);
      }
    }

    // --- INIT ---
    regionSelector.addEventListener("change", e => {
      renderSpots(e.target.value);
    });
    renderSpots("dakar");
  </script>
</body>
</html>