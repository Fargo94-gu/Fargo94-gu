<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Surf Spots Dakar ‚Äî Live</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#f0f9ff; font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto; }
    .arrow { display:inline-block; width:36px; height:36px; transform-origin: center center; transition: transform 0.4s ease; }
    .spot-card { min-height:220px; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">
  <h1 class="text-2xl font-bold mb-6">üåä Surf Spots - Dakar (live)</h1>

  <div id="spots" class="grid md:grid-cols-3 gap-6 w-full max-w-6xl"></div>

  <div id="tides" class="mt-10 bg-white p-4 rounded-2xl shadow w-full max-w-3xl text-center"></div>

  <button id="refreshBtn" class="mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
    Actualiser les donn√©es
  </button>

  <script>
    const API_KEY_WorldTides = "190f6e2f-4a39-4645-8926-17b57688273b"; // CL√â WORLD TIDES

    function renderTidesError() {
      const tideDiv = document.getElementById("tides");
      tideDiv.innerHTML = "<p class='text-red-600'>Erreur de chargement des mar√©es. Cl√© API incorrecte ou limite d'utilisation atteinte.</p>";
    }

    async function fetchTides() {
      const tideDiv = document.getElementById("tides");
      tideDiv.innerHTML = "<p class='text-center'>Chargement des mar√©es...</p>";

      try {
          const today = new Date().toISOString().split('T')[0];
          const tideUrl = `https://www.worldtides.info/api?extremes&lat=14.66&lon=-17.43&key=${API_KEY_WorldTides}&date=${today}`;
          const res = await fetch(tideUrl);

          if (!res.ok) {
              throw new Error(`Erreur de l'API: ${res.status}`);
          }
          const data = await res.json();

          if (!data.extremes || data.extremes.length === 0) {
              throw new Error("Donn√©es de mar√©e non disponibles");
          }

          const extremes = data.extremes;
          const now = new Date();
          let nextHigh = null, nextLow = null;

          for (const extreme of extremes) {
              const extremeTime = new Date(extreme.dt * 1000);
              if (extremeTime > now) {
                  if (extreme.type === 'High' && !nextHigh) {
                      nextHigh = { time: extremeTime, val: extreme.height };
                  } else if (extreme.type === 'Low' && !nextLow) {
                      nextLow = { time: extremeTime, val: extreme.height };
                  }
              }
              if (nextHigh && nextLow) break;
          }

          tideDiv.innerHTML = `
            <h2 class="text-lg font-bold mb-3">üåä Mar√©es √† Dakar</h2>
            <p class="text-sm">Prochaine mar√©e haute : ${nextHigh ? new Date(nextHigh.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) + " (" + nextHigh.val.toFixed(1) + " m)" : "N/A"}</p>
            <p class="text-sm">Prochaine mar√©e basse : ${nextLow ? new Date(nextLow.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) + " (" + nextLow.val.toFixed(1) + " m)" : "N/A"}</p>
          `;
      } catch (e) {
          tideDiv.innerHTML = `<p class="text-red-600">Erreur chargement mar√©es: ${e.message}</p>`;
      }
    }

    function renderSpotsError() {
      const container = document.getElementById("spots");
      container.innerHTML = `
        <div class="col-span-3 text-center">
          <p class="text-red-600 font-bold mb-2">Les donn√©es de vagues et de vent ne sont pas disponibles</p>
          <p class="text-sm text-gray-500">Pour afficher ces donn√©es, il faut utiliser une API comme Stormglass.io (avec un quota journalier).</p>
        </div>
      `;
    }

    document.getElementById("refreshBtn").addEventListener("click", () => {
      fetchTides();
      renderSpotsError();
    });

    fetchTides();
    renderSpotsError();
  </script>
</body>
</html>
